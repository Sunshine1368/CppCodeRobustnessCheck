<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>液态玻璃 · C++ 强壮性检查</title>
  <!-- 使用 Inter 字体，更符合现代玻璃质感 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600&display=swap" rel="stylesheet">
  <!-- Font Awesome 6 (免费图标库) 用于点缀 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at 30% 30%, rgba(180, 220, 250, 0.6), rgba(220, 240, 255, 0.3) 60%, transparent 90%),
                  linear-gradient(145deg, #d9e8f5 0%, #b5d0e8 100%);
      background-attachment: fixed;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      backdrop-filter: blur(2px);
    }

    /* 主玻璃容器 */
    .glass-panel {
      width: 100%;
      max-width: 1100px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border-radius: 3.5rem 3.5rem 2.8rem 2.8rem;
      box-shadow: 0 25px 50px -10px rgba(0, 30, 60, 0.25),
                  inset 0 0 0 1px rgba(255, 255, 255, 0.7),
                  inset 0 2px 5px rgba(255, 255, 255, 0.5);
      padding: 2.2rem 2.5rem;
      transition: all 0.3s ease;
      border: 1px solid rgba(255,255,255,0.45);
    }

    /* 标题区 —— 液态光泽 */
    .title-section {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.8rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid rgba(255,255,255,0.35);
    }

    .title-section h1 {
      font-weight: 550;
      font-size: 2.2rem;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, #1e3b5c, #18344b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 5px rgba(255,255,255,0.5);
      flex: 1;
    }

    .code-badge {
      background: rgba(255,255,255,0.3);
      backdrop-filter: blur(8px);
      padding: 0.5rem 1.2rem;
      border-radius: 100px;
      font-size: 1rem;
      font-weight: 500;
      color: #1f4970;
      border: 1px solid rgba(255,255,255,0.7);
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .code-badge i {
      font-size: 1.2rem;
      color: #1f4970;
    }

    /* 两列布局: 左侧编辑器，右侧报告卡片 */
    .check-area {
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 1.8rem;
      margin: 1.2rem 0 1.8rem;
    }

    /* 左侧代码输入 —— 玻璃毛玻璃效果加强 */
    .code-wrapper {
      background: rgba(255, 255, 255, 0.25);
      border-radius: 2rem;
      padding: 1.5rem;
      box-shadow: inset 0 1px 3px rgba(255,255,255,0.8), 0 8px 20px rgba(0, 30, 50, 0.1);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.6);
    }

    .code-header {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
      color: #1e3e5c;
      font-weight: 500;
    }

    .code-header i {
      background: rgba(255,255,255,0.4);
      border-radius: 50%;
      padding: 0.5rem;
      font-size: 1.2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    #codeInput {
      width: 100%;
      min-height: 320px;
      background: rgba(255, 255, 255, 0.3);
      border: 1.5px solid rgba(255,255,255,0.7);
      border-radius: 1.5rem;
      padding: 1.4rem;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 0.95rem;
      line-height: 1.5;
      color: #092033;
      caret-color: #2c577e;
      resize: vertical;
      outline: none;
      box-shadow: inset 0 4px 10px rgba(0,0,0,0.02), 0 0 0 1px rgba(255,255,255,0.5);
      transition: all 0.2s;
      backdrop-filter: blur(4px);
    }

    #codeInput::placeholder {
      color: rgba(20, 50, 80, 0.45);
      font-style: italic;
      font-weight: 300;
    }

    #codeInput:focus {
      border-color: white;
      background: rgba(255, 255, 255, 0.4);
      box-shadow: inset 0 4px 12px rgba(0, 30, 50, 0.1), 0 0 0 3px rgba(255,255,255,0.3);
    }

    /* 右侧结果卡片 */
    .result-panel {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(12px);
      border-radius: 2.2rem;
      padding: 1.8rem 1.5rem;
      box-shadow: 0 15px 30px -10px rgba(0,30,60,0.2), inset 0 1px 2px rgba(255,255,255,0.8);
      border: 1px solid rgba(255,255,255,0.5);
      display: flex;
      flex-direction: column;
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 1.6rem;
      color: #13324b;
      font-weight: 550;
      font-size: 1.25rem;
      letter-spacing: -0.3px;
    }

    .result-header i {
      background: rgba(255,255,255,0.5);
      border-radius: 100%;
      padding: 0.5rem;
    }

    /* 总体评分仪表 (圆环简化) */
    .gauge-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.2);
      padding: 1rem 1.5rem;
      border-radius: 2rem;
      margin-bottom: 1.8rem;
      border: 1px solid rgba(255,255,255,0.5);
    }

    .strength-score {
      display: flex;
      flex-direction: column;
    }

    .score-label {
      font-size: 0.85rem;
      opacity: 0.7;
    }

    .score-value {
      font-size: 2.4rem;
      font-weight: 600;
      line-height: 1;
      color: #092c44;
      text-shadow: 0 2px 5px rgba(255,255,255,0.4);
    }

    .score-max {
      font-size: 0.9rem;
      opacity: 0.6;
    }

    .glowing-ring {
      width: 55px;
      height: 55px;
      border-radius: 100%;
      background: conic-gradient(from 120deg, #5aa9d9 0deg 270deg, rgba(255,255,255,0.4) 270deg 360deg);
      border: 3px solid rgba(255,255,255,0.7);
      box-shadow: 0 0 15px #7abfe0;
      transform: rotate(-90deg);
    }

    /* 检查结果明细列表 */
    .issues-list {
      flex: 1;
      list-style: none;
      margin: 0.5rem 0 1.2rem;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 0.3rem;
    }

    .issues-list li {
      background: rgba(255,255,255,0.25);
      margin: 0.6rem 0;
      padding: 0.75rem 1rem;
      border-radius: 1.5rem;
      font-size: 0.9rem;
      font-weight: 450;
      backdrop-filter: blur(2px);
      border: 1px solid rgba(255,255,255,0.6);
      display: flex;
      align-items: flex-start;
      gap: 8px;
      color: #072334;
    }

    .issues-list i {
      font-size: 1rem;
      min-width: 20px;
      margin-top: 2px;
    }

    .list-placeholder {
      background: transparent !important;
      border: 1px dashed rgba(255,255,255,0.5);
      justify-content: center;
      color: #19415f;
      font-style: italic;
      backdrop-filter: none;
    }

    /* 标准徽章行 */
    .standard-badge {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 1rem 0 1.4rem;
    }

    .std-item {
      background: rgba(255,255,255,0.35);
      backdrop-filter: blur(4px);
      padding: 0.4rem 1.2rem;
      border-radius: 40px;
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid white;
      color: #103853;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .std-item.active {
      background: rgba(210, 240, 255, 0.7);
      box-shadow: 0 0 12px #b5e0ff;
    }

    /* 底部按钮组 */
    .actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 0.5rem;
    }

    .glass-button {
      background: rgba(255,255,255,0.3);
      backdrop-filter: blur(12px);
      border: 1.5px solid rgba(255,255,255,0.9);
      padding: 0.9rem 2.2rem;
      border-radius: 3rem;
      font-weight: 600;
      font-size: 1rem;
      color: #07263e;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 5px 15px rgba(0, 20, 40, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .glass-button:hover {
      background: rgba(255,255,255,0.55);
      border-color: white;
      transform: scale(1.02);
      box-shadow: 0 10px 25px rgba(0,40,70,0.2);
    }

    .glass-button:active {
      transform: scale(0.98);
    }

    .glass-button.secondary {
      background: rgba(220, 240, 255, 0.25);
      border-color: rgba(255,255,255,0.8);
    }

    /* 自定义滚动条 (更融洽) */
    .issues-list::-webkit-scrollbar {
      width: 6px;
    }

    .issues-list::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.15);
      border-radius: 20px;
    }

    .issues-list::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.7);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.3);
    }

    /* 响应式 */
    @media (max-width: 750px) {
      .glass-panel { padding: 1.5rem; }
      .check-area { grid-template-columns: 1fr; }
    }

    /* 额外液态元素 */
    .glow-text {
      color: #0a334e;
    }
  </style>
</head>
<body>
  <div class="glass-panel">
    <!-- 标题行 透明液态玻璃风格 -->
    <div class="title-section">
      <h1><i class="fa-regular fa-cube" style="margin-right: 12px;"></i>液态·C++ 强健性检查</h1>
      <div class="code-badge">
        <i class="fa-regular fa-file-code"></i> <span>ISO/IEC 14882</span> <i class="fa-regular fa-circle-check" style="margin-left: 5px;"></i>
      </div>
    </div>

    <!-- 核心区域: 输入 + 结果 -->
    <div class="check-area">
      <!-- 左侧代码编辑区 -->
      <div class="code-wrapper">
        <div class="code-header">
          <i class="fa-regular fa-keyboard"></i> <span>源代码</span> 
          <span style="flex:1; text-align: right; font-size: 0.85rem; opacity:0.6;">C++17 / C++20 检查</span>
        </div>
        <textarea id="codeInput" placeholder="// 贴上你的 C++ 代码 ...&#10;#include &lt;iostream&gt;&#10;int main() {&#10;    std::cout &lt;&lt; \"Hello, world\" &lt;&lt; std::endl;&#10;    return 0;&#10;}">#include <iostream>
#include <vector>
using namespace std;

int main() {
    int* p = new int(42);
    vector<int> v;
    v.push_back(10);
    cout << "value: " << *p << endl;
    // 忘记 delete p
    return 0;
}</textarea>
      </div>

      <!-- 右侧结果卡片 玻璃质感 -->
      <div class="result-panel">
        <div class="result-header">
          <i class="fa-regular fa-clipboard"></i> 检查报告
          <span style="font-size: 0.75rem; background: rgba(255,255,255,0.4); padding: 0.2rem 0.8rem; border-radius: 50px; margin-left: auto;">实时</span>
        </div>

        <!-- 强度仪表盘 液态光泽 -->
        <div class="gauge-container">
          <div class="strength-score">
            <span class="score-label">强壮指数</span>
            <span class="score-value" id="scoreDisplay">73</span><span class="score-max">/100</span>
          </div>
          <div class="glowing-ring" id="gaugeRing" style="background: conic-gradient(from 120deg, #5aa9d9 0deg 262.8deg, rgba(255,255,255,0.4) 262.8deg 360deg);"></div>
        </div>

        <!-- 动态检查条目 (强壮性 & 标准性问题) -->
        <ul class="issues-list" id="issuesList">
          <!-- 由js动态填充 -->
          <li class="list-placeholder"><i class="fa-regular fa-circle-check" style="color:#1d6f2e;"></i> 正在分析代码…</li>
        </ul>

        <!-- 标准符合性徽章 (透明玻璃胶囊) -->
        <div class="standard-badge" id="standardBadges">
          <span class="std-item" data-std="c++11"><i class="fa-regular fa-star"></i> C++11</span>
          <span class="std-item" data-std="c++14"><i class="fa-regular fa-star"></i> C++14</span>
          <span class="std-item" data-std="c++17"><i class="fa-regular fa-star"></i> C++17</span>
          <span class="std-item" data-std="c++20"><i class="fa-regular fa-star"></i> C++20</span>
        </div>
        
        <!-- 提示行 (额外液态效果) -->
        <div style="margin-top: 0.6rem; font-size: 0.75rem; opacity: 0.65; display: flex; gap: 15px; color: #0b2c41;">
          <i class="fa-regular fa-lightbulb"></i> 检测内存、异常安全、未定义行为
        </div>
      </div>
    </div>

    <!-- 操作按钮 透明玻璃 -->
    <div class="actions">
      <button class="glass-button secondary" id="resetBtn"><i class="fa-regular fa-rotate-right"></i> 重置示例</button>
      <button class="glass-button" id="checkBtn"><i class="fa-regular fa-flask"></i> 执行液态检查</button>
    </div>
  </div>

  <script>
    (function() {
      // 获取DOM元素
      const codeInput = document.getElementById('codeInput');
      const issuesList = document.getElementById('issuesList');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const gaugeRing = document.getElementById('gaugeRing');
      const stdBadges = document.querySelectorAll('.std-item');
      const checkBtn = document.getElementById('checkBtn');
      const resetBtn = document.getElementById('resetBtn');

      // 默认代码（与textarea内一致）
      const DEFAULT_CODE = `#include <iostream>
#include <vector>
using namespace std;

int main() {
    int* p = new int(42);
    vector<int> v;
    v.push_back(10);
    cout << "value: " << *p << endl;
    // 忘记 delete p
    return 0;
}`;

      // ----- 强壮性 & 标准检查模拟引擎 (基于规则扫描) -----
      function analyzeCode(code) {
        const issues = [];
        let totalScore = 100;  // 起始100，扣分项

        // 规则1: 检测裸new无对应delete (内存泄漏)
        if ((code.match(/new\s+\w+/g) || []).length > 0) {
          const deleteCount = (code.match(/delete/g) || []).length;
          const newCount = (code.match(/new\s+[a-zA-Z_]/g) || []).length;
          // 简单启发: 如果new比delete多且没有出现智能指针
          if (newCount > deleteCount && !code.includes('shared_ptr') && !code.includes('unique_ptr')) {
            issues.push({ icon: 'fa-regular fa-droplet', text: '内存泄漏风险: 存在 raw new 无对应 delete', severity: 'high' });
            totalScore -= 18;
          }
        }

        // 规则2: 检测vector却没有reserve (潜在性能/异常安全问题)
        if (code.includes('vector<') && !code.includes('reserve(') && code.includes('push_back')) {
          issues.push({ icon: 'fa-regular fa-clock', text: 'vector 频繁 push_back 但未 reserve, 可能引起多次重分配及异常安全削弱', severity: 'medium' });
          totalScore -= 8;
        }

        // 规则3: 使用using namespace std; (标准实践不推荐)
        if (code.includes('using namespace std;')) {
          issues.push({ icon: 'fa-regular fa-circle-exclamation', text: '使用了 using namespace std; (可能引起命名空间冲突，降低代码健壮性)', severity: 'low' });
          totalScore -= 6;
        }

        // 规则4: 检测缺少异常处理 (可能缺乏健壮性)
        if (code.includes('throw') && !code.includes('catch') ) {
          issues.push({ icon: 'fa-regular fa-bug', text: '存在throw但缺少catch块，异常可能未被妥善处理', severity: 'medium' });
          totalScore -= 12;
        } else if (!code.includes('catch') && (code.includes('new ') || code.includes('fopen'))) {
          // 资源操作但无异常捕获提示
          issues.push({ icon: 'fa-regular fa-shield', text: '资源分配无异常处理保证，建议使用RAII包装', severity: 'low' });
          totalScore -= 5;
        }

        // 规则5: 检测迭代器失效风险 (例如在vector循环中插入)
        if (code.includes('for') && code.includes('push_back') && code.includes('begin()')) {
          issues.push({ icon: 'fa-regular fa-triangle-exclamation', text: '循环中修改容器可能导致迭代器失效 (需谨慎)', severity: 'medium' });
          totalScore -= 10;
        }

        // 规则6: 检查printf/scanf 系列 (C风格, 类型不安全)
        if (code.match(/printf\(|scanf\(/)) {
          issues.push({ icon: 'fa-regular fa-flag', text: '使用了 C 风格 I/O (建议使用 iostream 增加类型安全)', severity: 'low' });
          totalScore -= 5;
        }

        // 规则7: 检查 nullptr 使用 (C++11 标准，使用NULL可能不够现代)
        if (code.includes('NULL') && !code.includes('nullptr')) {
          issues.push({ icon: 'fa-regular fa-circle', text: '使用了 NULL 而非 nullptr (C++11 推荐)', severity: 'low' });
          totalScore -= 3;
        }

        // 规则8: 检查未初始化指针/变量
        if (code.includes('int* p;') && !code.includes('= nullptr') && !code.includes('new')) {
          issues.push({ icon: 'fa-regular fa-question', text: '指针未初始化或赋予有效地址', severity: 'high' });
          totalScore -= 15;
        }

        // 规则9: 检测潜在的除零 (演示)
        if (code.includes('/') && (code.includes('x = 0') || code.includes('y = 0'))) {
          // 很弱的检测，仅示例
          issues.push({ icon: 'fa-regular fa-calculator', text: '存在可能除零的赋值，请检查算术安全', severity: 'medium' });
          totalScore -= 8;
        }

        // 确保分数不小于0
        totalScore = Math.max(12, Math.min(99, totalScore));

        // 如果没有issue，加一条干净提示
        if (issues.length === 0) {
          issues.push({ icon: 'fa-regular fa-thumbs-up', text: '代码看起来强健，符合常见最佳实践', severity: 'good' });
        } else {
          // 按严重程度排序 (高在前)
          issues.sort((a, b) => {
            const w = { high: 3, medium: 2, low: 1, good: 0 };
            return (w[b.severity] || 0) - (w[a.severity] || 0);
          });
        }

        return { issues, score: totalScore };
      }

      // 根据分数更新仪表盘背景
      function updateGauge(score) {
        const angle = (score / 100) * 360;  // 0-360度
        gaugeRing.style.background = `conic-gradient(from 120deg, #5aa9d9 0deg ${angle}deg, rgba(255,255,255,0.4) ${angle}deg 360deg)`;
      }

      // 更新标准徽章高亮 (基于代码内容模拟检测符合哪个标准)
      function updateStdBadges(code) {
        // 先全部重置为非激活
        stdBadges.forEach(b => b.classList.remove('active'));

        // 非常简化的检测: 根据一些关键词推测支持的标准
        const cpp11Features = ['nullptr', 'auto', 'range-based', 'initializer_list', 'static_assert', 'override', 'final'].some(f => code.includes(f));
        const cpp14Features = ['make_unique', 'generic lambda', '[[deprecated]]', 'digit separators'].some(f => code.includes(f));
        const cpp17Features = ['std::optional', 'std::variant', 'if constexpr', 'structured binding', 'fold expression', '[[maybe_unused]]', 'std::filesystem'].some(f => code.includes(f));
        const cpp20Features = ['concept', 'requires', 'std::span', 'constexpr vector', 'constexpr string', 'coroutine', 'co_await', 'co_yield', 'co_return', 'operator<=>', 'char8_t'].some(f => code.includes(f));

        // 简单激活: 如果包含该时代典型特征则激活对应徽章 (但保留基础C++11)
        document.querySelector('[data-std="c++11"]').classList.add('active'); // 默认最低C++11
        if (cpp14Features || code.includes('make_unique')) document.querySelector('[data-std="c++14"]').classList.add('active');
        if (cpp17Features || code.includes('std::optional') || code.includes('std::variant')) document.querySelector('[data-std="c++17"]').classList.add('active');
        if (cpp20Features) document.querySelector('[data-std="c++20"]').classList.add('active');
        
        // 如果连nullptr都没有，C++11不亮（这里简单处理：不亮C++11）
        if (!cpp11Features && !code.includes('nullptr') && !code.includes('auto') && !code.includes('static_assert')) {
          document.querySelector('[data-std="c++11"]').classList.remove('active');
        }
      }

      // 渲染检查结果
      function renderCheck() {
        const code = codeInput.value;
        const { issues, score } = analyzeCode(code);

        // 更新得分
        scoreDisplay.textContent = score;
        updateGauge(score);

        // 更新issue列表
        issuesList.innerHTML = '';
        if (issues.length === 0) {
          issuesList.innerHTML = '<li class="list-placeholder"><i class="fa-regular fa-circle-check"></i> 未发现明显问题，代码强健</li>';
        } else {
          issues.forEach(issue => {
            const li = document.createElement('li');
            // 根据严重程度选择图标颜色 (保留原有icon)
            let iconColor = '';
            if (issue.severity === 'high') iconColor = '#b63e32';
            else if (issue.severity === 'medium') iconColor = '#bf8b2c';
            else if (issue.severity === 'low') iconColor = '#2d6180';
            else iconColor = '#1d6f2e';
            li.innerHTML = `<i class="${issue.icon}" style="color: ${iconColor};"></i> <span>${issue.text}</span>`;
            issuesList.appendChild(li);
          });
        }

        // 更新标准徽章
        updateStdBadges(code);
      }

      // 重置示例
      function resetToDefault() {
        codeInput.value = DEFAULT_CODE;
        renderCheck();
      }

      // 绑定事件
      checkBtn.addEventListener('click', (e) => {
        e.preventDefault();
        renderCheck();
      });

      resetBtn.addEventListener('click', (e) => {
        e.preventDefault();
        resetToDefault();
      });

      // 页面载入后立刻执行一次渲染 (展示默认代码的结果)
      window.addEventListener('load', () => {
        renderCheck();
      });

      // 可选：当输入框内容变化实时检查（可省，但为流畅体验添加一个防抖）
      let timeoutId;
      codeInput.addEventListener('input', () => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
          renderCheck();
        }, 500);
      });
    })();
  </script>
</body>
</html>